@model OrdersListViewModel

@{
    ViewData["Title"] = "Orders";
}

<h1>@ViewData["Title"]</h1>

<!-- Filter for fraudulent orders -->
<div class="form-group">
    <label for="fraudFilter">Filter by Fraudulence:</label>
    <select class="form-control" id="fraudFilter">
        <option value="">All Orders</option>
        <option value="true">Fraudulent Orders</option>
        <option value="false">Non-Fraudulent Orders</option>
    </select>
</div>

<table class="table">
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Customer ID</th>
            <th>Date Time</th>
            <th>Entry Mode</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Country</th>
            <th>Fraudulent? (Prediction)</th>
            <th>Fraudulent? (Actual)</th>
            <th>Edit</th>
            <th>Remove</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var order in Model.Orders)
        {
            <tr>
                <td>@order.Id</td>
                <td>@order.CustomerId</td>
                <td>@order.DateTime</td>
                <td>@(order.Transaction != null ? order.Transaction.EntryMode : "N/A")</td>
                <td>@(order.Transaction != null ? order.Transaction.Amount.ToString("C") : "N/A")</td>
                <td>@order.Type</td>
                <td>@order.ShippingAddress.Country</td>
                <td>@order.FraudPrediction</td>
                <td>@order.IsFraud</td>
                <td><button asp-controller="Admin" asp-action="OrderForm" asp-route-orderId="@order.Id" formmethod="get">Edit</button></td>
                <td><button asp-controller="Admin" asp-action="DeleteConfirmation" asp-route-orderId="@order.Id" formmethod="get">Remove</button></td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Orders.Any())
{
    <p>No orders found.</p>
}

@section scripts {
    <script>
        document.getElementById('fraudFilter').addEventListener('change', function () {
            var selectedOption = this.value;
            var orders = @Html.Raw(Json.Serialize(Model.Orders));

            var filteredOrders = orders.filter(function (order) {
                if (selectedOption === '') {
                    return true; // Show all orders
                } else {
                    return order.IsFraud === (selectedOption === 'true');
                }
            });

            var tbody = document.querySelector('table tbody');
            tbody.innerHTML = '';

            if (filteredOrders.length > 0) {
                filteredOrders.forEach(function (order) {
                    var row = `<tr>
                                <td>${order.Id}</td>
                                <td>${order.CustomerId}</td>
                                <td>${order.DateTime}</td>
                                <td>${order.Transaction != null ? order.Transaction.EntryMode : 'N/A'}</td>
                                <td>${order.Transaction != null ? order.Transaction.Amount.toFixed(2) : 'N/A'}</td>
                                <td>${order.Type}</td>
                                <td>${order.ShippingAddress.Country}</td>
                                <td>${order.FraudPrediction}</td>
                                <td>${order.IsFraud}</td>
                                <td><button asp-controller="Admin" asp-action="OrderForm" asp-route-orderId="${order.Id}" formmethod="get">Edit</button></td>
                                <td><button asp-controller="Admin" asp-action="DeleteConfirmation" asp-route-orderId="${order.Id}" formmethod="get">Remove</button></td>
                            </tr>`;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="11">No orders found.</td></tr>';
            }
        });
    </script>
}
